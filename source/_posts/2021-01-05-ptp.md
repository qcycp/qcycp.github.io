---
title: ptp
abbrlink: b0e67c8c
date: 2021-01-05 15:28:22
categories: System
tags:
- Linux
---
* PTP (Precise Time Protocol)
* PTP 精準度較 NTP 好，NTP 只能精確到毫秒，PTP 能精確到微秒
* 確認網卡是否支援 PTP 功能
```
# ethtool -T enp134s0f0
Time stamping parameters for enp134s0f0:
Capabilities:
    hardware-transmit     (SOF_TIMESTAMPING_TX_HARDWARE)
    software-transmit     (SOF_TIMESTAMPING_TX_SOFTWARE)
    hardware-receive      (SOF_TIMESTAMPING_RX_HARDWARE)
    software-receive      (SOF_TIMESTAMPING_RX_SOFTWARE)
    software-system-clock (SOF_TIMESTAMPING_SOFTWARE)
    hardware-raw-clock    (SOF_TIMESTAMPING_RAW_HARDWARE)
PTP Hardware Clock: 1
Hardware Transmit Timestamp Modes:
    off                   (HWTSTAMP_TX_OFF)
    on                    (HWTSTAMP_TX_ON)
Hardware Receive Filter Modes:
    none                  (HWTSTAMP_FILTER_NONE)
    all                   (HWTSTAMP_FILTER_ALL)
```
* ptp4l 用於調整 PHC (PTP Hardware Clock) 時鐘，phc2sys 調整系統時鐘
1. 使用 ptp4l 指令，將 enp134s0f0 中的 PHC 做為 slave mode，同步為 master 的時間 (在 ptp4l.conf 中設定 master 來源)
2. 使用 phc2sys 指令，將 enp134s0f0 中的 PHC 時間，同步到系統時間
```
# ptp4l -i enp134s0f0 -m -s -f ptp4l.conf
 -i [dev]  interface device to use
 -m        print messages to stdout
 -s        slave only mode
 -f [file] read configuration from 'file'

# phc2sys -s enp134s0f0 -w -m -n 44
 -s [dev|name]  master clock
 -w             wait for ptp4l
 -m             print messages to stdout
 -n [num]       domain number
```
* Reference
https://www.2cm.com.tw/2cm/zh-tw/tech/1B2EBAC1BE7F4700A836C4AE040D5873