---
title: RU_mac
abbrlink: 7b4b6567
tags:
---
* For N77 PVT, 會把 MAC 寫在 EEPROM 0x00 0x26 0x6d 0x02 0x03 0x17
```
root@arria10:/usr/utils# ls
eeprom_r       eeprom_w       kill_ptp4l.sh  led_ctrl       lna_ctrl
root@arria10:/usr/utils# ./eeprom_r
0000: 0x00 0x37 0xb1 0xd0 0x00 0x3d 0x7e 0x30 0x77 0x00 0xde 0xad 0x00 0x02 0x00 0x02
0010: 0x4d 0x32 0x31 0x34 0x36 0x30 0x33 0x33 0x35 0x38 0x00 0x02 0xde 0xad 0xde 0xad
0020: 0x4d 0x32 0x31 0x34 0x37 0x30 0x31 0x35 0x32 0x35 0x00 0x03 0xde 0xad 0xde 0xad
0030: 0x4d 0x32 0x32 0x30 0x31 0x30 0x33 0x30 0x32 0x31 0xde 0xad 0xde 0xad 0xde 0xad
0040: 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad
0050: 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad
0060: 0xee 0x11 0x00 0x26 0x6d 0x02 0x03 0x17 0xde 0xad 0xde 0xad 0xde 0xad 0xde 0xad
0070: 0xee 0x11 0x0e 0xa6 0x00 0x05 0x00 0x54 0x00 0x80 0x00 0xb1 0x00 0xe3 0x01 0x16
```

* 實際讀取、設定 MAC，會根據 socfpga_arria10_socdk_sdmmc.dtb 的內容
```
root@arria10:~/sdcard# ls
RRHconfig_xran.xml               fit_spl_fpga.itb                 hw_ver.txt                       u-boot.img
RRHconfig_xran_default.xml       ghrd_10as066n2.core.rbf          socfpga_arria10_socdk_sdmmc.dtb  zImage
extlinux                         ghrd_10as066n2.periph.rbf        u-boot-splx4.sfp                 z_version.txt
```

* 修改 socfpga_arria10_socdk_sdmmc.dtb 的內容
  ![](image01.png)
```
root@arria10:~/sdcard# printf '\x6c\xad\xad\x00\x00\x21' | dd of=socfpga_arria10_socdk_sdmmc.dtb bs=1 seek=17452 count=6
6+0 records in
6+0 records out
6 bytes (6B) copied, 0.002423 seconds, 2.4KB/s
```

* 讀取 eeprom 內容，修改 dtb 檔
```
#!/bin/bash

data=$(/usr/utils/eeprom_r | grep 0060:)
mac0=$(echo $data | awk '{print $4}' | sed -e "s/0x/\\\x/g")
mac1=$(echo $data | awk '{print $5}' | sed -e "s/0x/\\\x/g")
mac2=$(echo $data | awk '{print $6}' | sed -e "s/0x/\\\x/g")
mac3=$(echo $data | awk '{print $7}' | sed -e "s/0x/\\\x/g")
mac4=$(echo $data | awk '{print $8}' | sed -e "s/0x/\\\x/g")
mac5=$(echo $data | awk '{print $9}' | sed -e "s/0x/\\\x/g")

cd /home/root/sdcard/
printf ${mac0}${mac1}${mac2}${mac3}${mac4}${mac5} | dd of=socfpga_arria10_socdk_sdmmc.dtb bs=1 seek=17452 count=6 conv=notrunc

/home/root/test/reboot.sh
```