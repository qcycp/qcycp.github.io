1. 每個 stage 負責的工作 , 每個 stage 運作的重點以及時間
2. source_stage 選 target 的機制 (挑選是否公平 , retry 時的選擇機制考量)
3. retry 機制如何運作
4. 是否有在 process crash 時 , 系統可以有紀錄

Trace exec time(ms) <-- 發現 track 到辨識完的時間
identify time(ms) <--- 實際目標鎖定以後到辨識完畢的時間



image quality 紀錄 http://10.36.94.194:2222/task-view-1632.html
image quality http://10.36.94.101/SI/nucleus_vas/commit/f5ede947738f8b7a4a1ce8d1010e2c2a82c35955
你有發現啥有問題的  或是效能問題  可以記錄在  http://10.36.94.194:2222/task-view-1614.html

靜態辨識最簡單的 flow  http://10.36.94.101/SI/nucleus_vas/blob/dev/src/cpp/hh_recognize.cpp

如果你要改改 code 可以用   ssh user@10.60.3.12 -p 10022 密碼 123456
folder /home/user/data/app/nucleus_vas


user@user:~/data/app/nucleus_vas$ git log
commit f5ede947738f8b7a4a1ce8d1010e2c2a82c35955 (HEAD -> dev, origin/dev)
Author: Anson Ku <anson.cc.ku@fii-foxconn.com>
Date:   Tue Feb 11 06:06:11 2020 +0000

    Add image quality function

user@user:~/data/app/nucleus_vas$ git branch -a
* dev


Q
1. 
faces = g_fd_recognize->Detect(background, false);
這些臉會有順序嗎? 取faces[0]來處理，它有什麼優先權條件?
1:N api送來的臉如果有兩個?
2. 
p_feature1 = target_feature.data();
de_feature1 = g_fr_recognize->Dequantize(p_feature1);

if (p_feature1 == NULL) {...}
如果p_feature1真的是null，g_fr_recognize->Dequantize不會出錯嗎?
3. source stage 包含 read rtsp frame -> face detection -> update tracking list
分開?





1. source
* read rtsp frame
capture.read(bgr_frame);
* face detection
vas_fd->Detect(bgr_frame, true);
* update tracking list
doTracking(tracking_list);
* choose available track according to yaw/pitch/roo/...
  * if all faces cannot pass the condition => skip and goto next frame
* update base frame according score

2. feature
* check quality
* extract feature
* get crop image

3. compare
* comapre all features and get recognition result

4. event
* prepare recognition events

5. track
* send result to websocket

T1
setup server
T2
receive track event => send event
T3
send keepalive event

crash log紀錄、notify
靜態1.N api pipeline


Q
1. kangaroo跟nucleus的溝通? 改分數/pitch/roll/yaw
2. 
3. 

todo list
1A. GPU版本的辨識照片id錯誤，這樣會無法在前端顯示出辨識事件中，是根據哪一張照片來比對feature的
2A. 靜態API中的open_door判斷可以拿掉
3A. 1:N的分數固定是73? 從後台改的分數只針對動態?


1B. 許多threshold散落各地，且值從哪來?
threshold_similarity = 73;
靜態
fd_builder.min_face_ratio = 0.044;
fd_builder.redetection_period = 10;
動態
fd_builder.min_face_ratio = 0.050;

2B. 固定隔13個frame印一次fd結果，真正偵測到臉的fd不一定會被印到，這樣會失了真意
3B. dataset裡包含了所有subject的資料，在更改辨識不相關的欄位時，也會影響到dataset的更新 => 沒有必要
    只需要subject_id跟photo足以?!
4B. stage_event 存在與否?
5B. hh_Camera::stage_track，不是event trigger的
6B. std library to array
7B. nucleus crash record/notify
     => when nucleus start, append message to a log file
     => 大約一個小時會有一份(10M)的log，總共只會留19+1份，夠嗎?


1C. system ability, 目前辨識的效能? 一個1:N要多久? 在部署完之後，一鍵知道有沒有問題(cpu有沒有pin)
2C. multi-face track
3C. 陌生人太多，對於考勤紀錄可能不會有影響，但不適用於陌生人告警，是否也可以用某些條件/閥值來控制
4C. 靜態辨識api改為pipeline處理，1:N api不會建thread去執行






問題
1. nvidia gpu的code在git的哪個project?

Note:
1. 在哪裡監控IPCAM reconnected
2. camera有worker，box也有worker



typedef enum {
    0 TRACK_STATE_NULL,
    1 TRACK_STATE_TRACKING,
    2 TRACK_STATE_BESTFRAME,
    3 TRACK_STATE_FEATURE,
    4 TRACK_STATE_RECOGNIZE,
    5 TRACK_STATE_WAIT_RETRY,
    6 TRACK_STATE_WAIT_RETRY_GONE,
    7 TRACK_STATE_RECOGNIZE_SOCKET,
    8 TRACK_STATE_DISAPPEAR
} hh_TrackState_t;

init
main
  CWrapper_Init
    hh_system_init
      hh_system_load_configuration_file
      hh_checkin_init
      hh_recognize_init
      hhi_feature_extraction_init
    StartDatasetManager
    StartCameraManager


 10M -rwxr--r-- 1 root root  10M Feb 17 09:25 '@400000005e4a5c0428a54fc4.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 10:32 '@400000005e4a6bb92d60b4f4.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 11:39 '@400000005e4a7b6208bde84c.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 12:45 '@400000005e4a8ae51a5ca264.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 13:51 '@400000005e4a9a810c274a3c.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 14:58 '@400000005e4aaa3d0f75fc24.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 16:05 '@400000005e4ab9d51787181c.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 17:12 '@400000005e4ac99310672e3c.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 18:19 '@400000005e4ad9233a86df3c.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 19:26 '@400000005e4ae8e71bd10284.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 20:33 '@400000005e4af8a10be73bcc.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 21:40 '@400000005e4b086e048f984c.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 22:47 '@400000005e4b180a161b531c.s'*
 10M -rwxr--r-- 1 root root  10M Feb 17 23:54 '@400000005e4b27a815726504.s'*
 10M -rwxr--r-- 1 root root  10M Feb 18 01:00 '@400000005e4b37531c4f2b64.s'*
 10M -rwxr--r-- 1 root root  10M Feb 18 01:52 '@400000005e4b437100998aa4.s'*
9.9M -rwxr--r-- 1 root root 9.9M Feb 18 02:22 '@400000005e4b4a8518af34cc.s'*
9.9M -rwxr--r-- 1 root root 9.9M Feb 18 02:58 '@400000005e4b52d60dbd6ee4.s'*
9.9M -rwxr--r-- 1 root root 9.9M Feb 18 03:32 '@400000005e4b5ada33fa1d3c.s'*
1.4M -rw-r--r-- 1 root root 1.4M Feb 18 03:37  current




hh_WebSocketServer::workerLoop_T3 3s
hh_Camera::stage_source 15fps
hh_Camera::stage_track 400ms