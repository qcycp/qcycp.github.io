<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qcycp.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="筆記本">
<meta property="og:url" content="https:&#x2F;&#x2F;qcycp.github.io&#x2F;page&#x2F;21&#x2F;index.html">
<meta property="og:site_name" content="筆記本">
<meta property="og:locale" content="zh-tw">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://qcycp.github.io/page/21/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-tw'
  };
</script>

  <title>筆記本</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">筆記本</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>連結</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://qcycp.github.io/posts/9452fe6b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nick Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="筆記本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/9452fe6b/" class="post-title-link" itemprop="url">qcow to vdi</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-12-03 10:23:28" itemprop="dateCreated datePublished" datetime="2019-12-03T10:23:28+08:00">2019-12-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-06-22 09:20:20" itemprop="dateModified" datetime="2020-06-22T09:20:20+08:00">2020-06-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install qemu-utils</span><br><span class="line">$ qemu-img convert -O vdi src.qcow2 dst.vdi</span><br><span class="line">$ qemu-img convert -O qcow2 src.vdi dst.qcow2</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://qcycp.github.io/posts/38a33950/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nick Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="筆記本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/38a33950/" class="post-title-link" itemprop="url">cmder</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-12-03 10:18:51" itemprop="dateCreated datePublished" datetime="2019-12-03T10:18:51+08:00">2019-12-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2021-08-30 09:20:16" itemprop="dateModified" datetime="2021-08-30T09:20:16+08:00">2021-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/cmder/" itemprop="url" rel="index"><span itemprop="name">cmder</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>修改提示符<br>Edit <code>cmder/vendor/clink.lua</code>，將λ改成$即可</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">42     <span class="built_in">local</span> cmder_prompt = <span class="string">"\x1b[1;32;40m&#123;cwd&#125; &#123;git&#125;&#123;hg&#125;&#123;svn&#125; \n\x1b[1;39;40m&#123;lamb&#125; \x1b[0m"</span></span><br><span class="line">43     <span class="built_in">local</span> lambda = <span class="string">"λ"</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>設定預設路徑<br>Settings =&gt; Startup =&gt; Tasks =&gt; {cmd::Cmder}<br><code>cmd /k &quot;&quot;%ConEmuDir%\..\init.bat&quot; &quot; -new_console:d:D:\GoogleDrive</code><br><img src="/posts/38a33950/cmder.png" alt></p>
</li>
<li><p>使用 cmder 操作 SSH<br>ssh <a href="mailto:user@192.168.56.101" target="_blank" rel="noopener">user@192.168.56.101</a><br>scp <a href="mailto:user@192.168.56.101" target="_blank" rel="noopener">user@192.168.56.101</a>:/home/user/file .</p>
</li>
<li><p>設定快速連接 SSH</p>
</li>
</ul>
<ol>
<li>新增 Task<br><img src="/posts/38a33950/image01.png" alt></li>
<li>設定ssh類別<br>a. <code>ssh::root@192.168.56.101</code><br>b. <code>/icon &quot;%CMDER_ROOT%\icons\cmder.ico&quot;</code><br>c. <code>cmd /c &quot;%ConEmuDir%\..\git-for-windows\usr\bin\ssh root@192.168.56.101 -new_console:d:%USERPROFILE% &quot;-new_console:t:192.168.56.101&quot;</code></li>
<li>設定 host 位址</li>
<li>設定 連線資訊<br><img src="/posts/38a33950/image02.png" alt></li>
<li>連線<br><img src="/posts/38a33950/image03.png" alt></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://qcycp.github.io/posts/d96b0415/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nick Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="筆記本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/d96b0415/" class="post-title-link" itemprop="url">GitLab 建置CI/CD流程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-12-02 15:34:12" itemprop="dateCreated datePublished" datetime="2019-12-02T15:34:12+08:00">2019-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-06-22 09:20:20" itemprop="dateModified" datetime="2020-06-22T09:20:20+08:00">2020-06-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/GitLab/" itemprop="url" rel="index"><span itemprop="name">GitLab</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="建立gitlab-runner"><a href="#建立gitlab-runner" class="headerlink" title="建立gitlab-runner"></a>建立gitlab-runner</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">gitlab-runner:</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitlab/gitlab-runner:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">gitlab-runner</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker-software/gitlab-runner/config:/etc/gitlab-runner</span></span><br></pre></td></tr></table></figure>

<h4 id="註冊runner"><a href="#註冊runner" class="headerlink" title="註冊runner"></a>註冊runner</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it gitlab-runner gitlab-runner register</span><br><span class="line">Runtime platform                                    arch=amd64 os=linux pid=165 revision=577f813d version=12.5.0</span><br><span class="line">Running <span class="keyword">in</span> system-mode.                            </span><br><span class="line">                                                   </span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://192.168.56.5/</span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">zS9KDv5_puTCKS32UbyM</span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">[c420481843b4]: <span class="built_in">test</span>-runner</span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">docker</span><br><span class="line">Registering runner... succeeded                     runner=zS9KDv5_</span><br><span class="line">Please enter the executor: shell, ssh, virtualbox, docker-ssh+machine, kubernetes, custom, docker-ssh, parallels, docker, docker+machine:</span><br><span class="line">docker</span><br><span class="line">Please enter the default Docker image (e.g. ruby:2.6): <span class="comment">#當.gitlab-ci.yml沒有指定image時，預設要用哪個docker image</span></span><br><span class="line">docker:19.03.5</span><br><span class="line">Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it<span class="string">'s running already the config should be automatically reloaded!</span></span><br></pre></td></tr></table></figure>
<ol>
<li>Please enter the gitlab-ci coordinator URL<br>輸入gitlab網站的URL</li>
<li>Please enter the gitlab-ci token for this runner<br>在gitlab CI/CD settings中，Specific/Shared Runners的identification</li>
<li>Please enter the gitlab-ci description for this runner<br>指定runner的名稱</li>
<li>Please enter the gitlab-ci tags for this runner<br>指定此runner的tag，在.gitlab-ci.yml中，必須指定對應的tag，才能使用此runner</li>
</ol>
<h4 id="docker-image-release-page"><a href="#docker-image-release-page" class="headerlink" title="docker image release page"></a>docker image release page</h4><p><a href="https://github.com/docker/docker-ce/releases" target="_blank" rel="noopener">https://github.com/docker/docker-ce/releases</a></p>
<h4 id="完成之後，config-toml內容如下"><a href="#完成之後，config-toml內容如下" class="headerlink" title="完成之後，config.toml內容如下"></a>完成之後，config.toml內容如下</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ cat /opt/docker-software/gitlab-runner/config/config.toml</span><br><span class="line">concurrent = 1</span><br><span class="line">check_interval = 0</span><br><span class="line"></span><br><span class="line">[session_server]</span><br><span class="line">  session_timeout = 1800</span><br><span class="line"></span><br><span class="line">[[runners]]</span><br><span class="line">  name = <span class="string">"test-runner"</span></span><br><span class="line">  url = <span class="string">"http://192.168.56.5/"</span></span><br><span class="line">  token = <span class="string">"zS9KDv5_puTCKS32UbyM"</span></span><br><span class="line">  executor = <span class="string">"docker"</span></span><br><span class="line">  [runners.custom_build_dir]</span><br><span class="line">  [runners.docker]</span><br><span class="line">    tls_verify = <span class="literal">false</span></span><br><span class="line">    image = <span class="string">"docker:19.03.5"</span></span><br><span class="line">    privileged = <span class="literal">false</span></span><br><span class="line">    disable_entrypoint_overwrite = <span class="literal">false</span></span><br><span class="line">    oom_kill_disable = <span class="literal">false</span></span><br><span class="line">    disable_cache = <span class="literal">false</span></span><br><span class="line">    volumes = [<span class="string">"/cache"</span>]</span><br><span class="line">    shm_size = 0</span><br><span class="line">  [runners.cache]</span><br><span class="line">    [runners.cache.s3]</span><br><span class="line">    [runners.cache.gcs]</span><br></pre></td></tr></table></figure>

<h4 id="remove-Runner"><a href="#remove-Runner" class="headerlink" title="remove Runner"></a>remove Runner</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it gitlab-runner gitlab-runner unregister --all-runners</span><br><span class="line">$ docker <span class="built_in">exec</span> -it gitlab-runner gitlab-runner unregister -n <span class="built_in">test</span>-runner</span><br></pre></td></tr></table></figure>

<h4 id="Trouble-Shooting"><a href="#Trouble-Shooting" class="headerlink" title="Trouble Shooting"></a>Trouble Shooting</h4><ol>
<li><p>Cannot connect to the Docker daemon at tcp://docker:2375. Is the docker daemon running?<br><code>method 1</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim .gitlab-ci.yml</span><br><span class="line">variables:</span><br><span class="line">  DOCKER_TLS_CERTDIR: &quot;&quot;</span><br></pre></td></tr></table></figure>
<p><code>method 2</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim config.toml</span><br><span class="line">[[runners]]</span><br><span class="line">  environment = [&quot;DOCKER_TLS_CERTDIR=&quot;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?<br>執行docker:dind，gitlab-runner config.toml中的privileged要設定為true，否則會有error</p>
</li>
<li><p>docker image download failed</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Step 1/13 : FROM 10.36.94.120:50000/kaluta:1.0.0</span><br><span class="line">Get https://10.36.94.120:50000/v2/: http: server gave HTTP response to HTTPS client</span><br></pre></td></tr></table></figure>
<p>在gitlab-runner config.toml中的volume要加入/etc/docker/daemon.json的設定<br>volumes = [“/cache”, “/etc/docker/daemon.json:/etc/docker/daemon.json”]</p>
</li>
<li><p>/bin/sh: eval: line 87: docker-compose: not found</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ vim .gitlab-ci.yml</span><br><span class="line">build:</span><br><span class="line">  stage: build</span><br><span class="line">  before_script:</span><br><span class="line">    - apk add --update libffi-dev openssl-dev py-pip python python-dev build-base</span><br><span class="line">    - pip install docker-compose</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="final-config-toml"><a href="#final-config-toml" class="headerlink" title="final config.toml"></a>final config.toml</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ cat /opt/docker-software/gitlab-runner/config/config.toml</span><br><span class="line">concurrent = 1</span><br><span class="line">check_interval = 0</span><br><span class="line"></span><br><span class="line">[session_server]</span><br><span class="line">  session_timeout = 1800</span><br><span class="line"></span><br><span class="line">[[runners]]</span><br><span class="line">  name = <span class="string">"test-runner"</span></span><br><span class="line">  url = <span class="string">"http://192.168.56.5/"</span></span><br><span class="line">  token = <span class="string">"zS9KDv5_puTCKS32UbyM"</span></span><br><span class="line">  executor = <span class="string">"docker"</span></span><br><span class="line">  [runners.custom_build_dir]</span><br><span class="line">  [runners.docker]</span><br><span class="line">    tls_verify = <span class="literal">false</span></span><br><span class="line">    image = <span class="string">"docker:19.03.5"</span></span><br><span class="line">    privileged = <span class="literal">true</span></span><br><span class="line">    disable_entrypoint_overwrite = <span class="literal">false</span></span><br><span class="line">    oom_kill_disable = <span class="literal">false</span></span><br><span class="line">    disable_cache = <span class="literal">false</span></span><br><span class="line">    volumes = [<span class="string">"/cache"</span>, <span class="string">"/etc/docker/daemon.json:/etc/docker/daemon.json"</span>]</span><br><span class="line">    shm_size = 0</span><br><span class="line">  [runners.cache]</span><br><span class="line">    [runners.cache.s3]</span><br><span class="line">    [runners.cache.gcs]</span><br></pre></td></tr></table></figure>

<h4 id="建立Base-image"><a href="#建立Base-image" class="headerlink" title="建立Base image"></a>建立Base image</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM docker:19.03.5</span><br><span class="line"></span><br><span class="line">ADD daemon.json /etc/docker/daemon.json</span><br><span class="line">RUN apk add --update libffi-dev openssl-dev py-pip python python-dev build-base rsync git xz sshpass openssh-client &amp;&amp; \</span><br><span class="line">    pip install docker-compose</span><br></pre></td></tr></table></figure>

<ol>
<li>在.gitlab-ci.yml中可以直接使用這個base image <code>image: 10.36.94.120:50000/docker:19.03.5</code>，這樣可以省略安裝package的步驟</li>
<li>在config.toml中可以不用設定volumes: “/etc/docker/daemon.json:/etc/docker/daemon.json”</li>
</ol>
<h4 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h4><ol>
<li>GitLab 的 build 都是在 Docker 上執行的，因此一開始會需要定義 image 名稱，而它將會成為下面執行 build 的環境</li>
<li>artifacts 會把裡面編譯或程式的產出物存放起來，提供介面給其他需要的人使用</li>
<li>dependencies 設定意思是指，test job 要取用 build job 的 artifacts，每個 job 都是獨立的 container ，互不相關，因此要靠這些設定來傳遞 artifacts</li>
<li>image 和 service 雖然有全域定義，但也能 job 各自定義</li>
<li>services:<ul>
<li>docker:dind<br>用 docker run 啟動 docker:dind 並把上面定義的 image 起的容器連結至 docker:dind</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://qcycp.github.io/posts/cb549ab5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nick Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="筆記本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/cb549ab5/" class="post-title-link" itemprop="url">docker-compose.yml for GitLab</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-12-02 11:05:17" itemprop="dateCreated datePublished" datetime="2019-12-02T11:05:17+08:00">2019-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-06-22 09:34:14" itemprop="dateModified" datetime="2020-06-22T09:34:14+08:00">2020-06-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/GitLab/" itemprop="url" rel="index"><span itemprop="name">GitLab</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span> </span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">gitlab:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitlab/gitlab-ce:latest</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="number">192.168</span><span class="number">.56</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">gitlab</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker-software/gitlab/config:/etc/gitlab</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker-software/gitlab/logs:/var/log/gitlab</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker-software/gitlab/data:/var/opt/gitlab</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">443</span><span class="string">:443</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">80</span><span class="string">:80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">22</span><span class="string">:22</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://qcycp.github.io/posts/8931cf79/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nick Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="筆記本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/8931cf79/" class="post-title-link" itemprop="url">GitBook文件轉換成pdf</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-12-02 09:58:20" itemprop="dateCreated datePublished" datetime="2019-12-02T09:58:20+08:00">2019-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-06-22 09:20:20" itemprop="dateModified" datetime="2020-06-22T09:20:20+08:00">2020-06-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/GitBook/" itemprop="url" rel="index"><span itemprop="name">GitBook</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install npm</span><br><span class="line">sudo npm install -g gitbook-cli</span><br><span class="line">sudo ln -s /usr/bin/nodejs /usr/bin/node</span><br><span class="line">sudo apt-get install calibre</span><br><span class="line">sudo npm install gitbook-pdf -g</span><br><span class="line">gitbook pdf .</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://qcycp.github.io/posts/d585e6aa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nick Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="筆記本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/d585e6aa/" class="post-title-link" itemprop="url">pyinstaller</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-11-25 17:29:00" itemprop="dateCreated datePublished" datetime="2019-11-25T17:29:00+08:00">2019-11-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2021-10-18 10:09:44" itemprop="dateModified" datetime="2021-10-18T10:09:44+08:00">2021-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install pyinstaller</span><br></pre></td></tr></table></figure>

<h1 id="生成exe檔"><a href="#生成exe檔" class="headerlink" title="生成exe檔"></a>生成exe檔</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pyinstaller &lt;config&gt; main.py</span><br></pre></td></tr></table></figure>

<h1 id="指定spec文件"><a href="#指定spec文件" class="headerlink" title="指定spec文件"></a>指定spec文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pyinstaller main.spec main.py</span><br></pre></td></tr></table></figure>

<h1 id="config"><a href="#config" class="headerlink" title="config"></a>config</h1><p><code>--noconsole</code>: 執行exe檔時，不顯示console視窗<br><code>--onefile</code>: 打包成單一個exe檔案<br><code>--icon</code>: 指定exe檔案的icon</p>
<h1 id="spec文件"><a href="#spec文件" class="headerlink" title="spec文件"></a>spec文件</h1><ol>
<li>控制pyinstall打包，以及程式run time執行時的配置</li>
<li>在執行pyinstall會根據指令的config自動建立，也可以透過以下指令單獨生成spec檔案<br>pyi-makespec <config> main.py</config></li>
<li>當專案中需要使用到額外的資源檔案時，必須手動編輯spec文件</li>
</ol>
<h1 id="steps-for-generate-exe-file"><a href="#steps-for-generate-exe-file" class="headerlink" title="steps for generate exe file:"></a>steps for generate exe file:</h1><ol>
<li><code>pyi-makespec --onefile --noconsole --icon D:\\FaceDetection\\data\fd.ico main.py</code></li>
<li>edit main.spec，添加static file to datas<br><code>a = Analysis(..., datas=[(&#39;D:\\FaceDetection\\data&#39;, &#39;data&#39;)], ...)</code><br>Note: datas中的資料為一tuple值，第一個欄位為檔案在系統中的路徑，第二個欄位為在打包環境中的路徑</li>
<li><code>pyinstaller main.spec main.py</code></li>
</ol>
<h1 id="sample-for-spec文件"><a href="#sample-for-spec文件" class="headerlink" title="sample for spec文件"></a>sample for spec文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: python ; coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">block_cipher = None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = Analysis([<span class="string">'main.py'</span>],</span><br><span class="line">             pathex=[<span class="string">'D:\\FaceDetection'</span>],</span><br><span class="line">             binaries=[],</span><br><span class="line">             datas=[(<span class="string">'D:\\FaceDetection\\data'</span>, <span class="string">'data'</span>)],</span><br><span class="line">             hiddenimports=[],</span><br><span class="line">             hookspath=[],</span><br><span class="line">             runtime_hooks=[],</span><br><span class="line">             excludes=[],</span><br><span class="line">             win_no_prefer_redirects=False,</span><br><span class="line">             win_private_assemblies=False,</span><br><span class="line">             cipher=block_cipher,</span><br><span class="line">             noarchive=False)</span><br><span class="line">pyz = PYZ(a.pure, a.zipped_data,</span><br><span class="line">             cipher=block_cipher)</span><br><span class="line">exe = EXE(pyz,</span><br><span class="line">          a.scripts,</span><br><span class="line">          a.binaries,</span><br><span class="line">          a.zipfiles,</span><br><span class="line">          a.datas,</span><br><span class="line">          [],</span><br><span class="line">          name=<span class="string">'main'</span>,</span><br><span class="line">          debug=False,</span><br><span class="line">          bootloader_ignore_signals=False,</span><br><span class="line">          strip=False,</span><br><span class="line">          upx=True,</span><br><span class="line">          upx_exclude=[],</span><br><span class="line">          runtime_tmpdir=None,</span><br><span class="line">          console=False , icon=<span class="string">'D:\\FaceDetection\\data\\fd.ico'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>Trouble Shooting<br><img src="/posts/d585e6aa/image01.png" alt><br><a href="https://stackoverflow.com/questions/37815371/pyinstaller-failed-to-execute-script-pyi-rth-pkgres-and-missing-packages" target="_blank" rel="noopener">https://stackoverflow.com/questions/37815371/pyinstaller-failed-to-execute-script-pyi-rth-pkgres-and-missing-packages</a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip uninstall pyinstaller</span><br><span class="line">pip install https://github.com/pyinstaller/pyinstaller/archive/develop.zip</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://qcycp.github.io/posts/410ebdbd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nick Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="筆記本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/410ebdbd/" class="post-title-link" itemprop="url">Deploy a Docker registry server</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-11-25 17:19:29" itemprop="dateCreated datePublished" datetime="2019-11-25T17:19:29+08:00">2019-11-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-06-22 09:20:20" itemprop="dateModified" datetime="2020-06-22T09:20:20+08:00">2020-06-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="pull-registry-image"><a href="#pull-registry-image" class="headerlink" title="pull registry image"></a>pull registry image</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  registry:</span><br><span class="line">    restart: always</span><br><span class="line">    image: registry:2</span><br><span class="line">    container_name: registry</span><br><span class="line">    ports:</span><br><span class="line">      - 5000:5000</span><br><span class="line">    volumes:</span><br><span class="line">      - /etc/timezone:/etc/timezone:ro</span><br><span class="line">      - /etc/localtime:/etc/localtime:ro</span><br><span class="line">      - /opt/docker-software/registry:/var/lib/registry</span><br><span class="line">    environment:</span><br><span class="line">      - REGISTRY_STORAGE_DELETE_ENABLED=<span class="string">"true"</span></span><br></pre></td></tr></table></figure>

<h1 id="push-pull-images"><a href="#push-pull-images" class="headerlink" title="push/pull images"></a>push/pull images</h1><p>image push前必須先tag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker tag myimage host:5000/myimage:1.0.0</span><br><span class="line">$ docker push host:5000/myimage:1.0.0</span><br><span class="line">$ docker image remove host:5000/myimage:1.0.0 <span class="comment"># remove the locally-cached host:5000/myimage:1.0.0</span></span><br><span class="line">$ docker pull host:5000/myimage:1.0.0</span><br></pre></td></tr></table></figure>

<h1 id="trouble-shooting"><a href="#trouble-shooting" class="headerlink" title="trouble shooting"></a>trouble shooting</h1><p>error message when push images to registry server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The push refers to repository [host:5000/myimage]</span><br><span class="line">Get https://host:5000/v2/: http: server gave HTTP response to HTTPS client</span><br></pre></td></tr></table></figure>
<ul>
<li>Insecure Registries<br>If this registry is insecure and doesn’t hide behing SSL certificates then you will need to configure your Docker client to allow pushing to this insecure registry.<br>Edit or you may even need to create the following file on your Linux server:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/docker/daemon.json</span><br></pre></td></tr></table></figure>
And save the following content:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"insecure-registries"</span>: [<span class="string">"host:5000"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
You will need to restart your Docker service before these changes will take effect.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service docker restart</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="get-image-list-from-docker-registry"><a href="#get-image-list-from-docker-registry" class="headerlink" title="get image list from docker registry"></a>get image list from docker registry</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X GET http://host:5000/v2/_catalog | jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"repositories"</span>: [</span><br><span class="line">    <span class="string">"myimage"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl -X GET http://host:5000/v2/&lt;myimage&gt;/tags/list | jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"myimage"</span>,</span><br><span class="line">  <span class="string">"tags"</span>: [</span><br><span class="line">    <span class="string">"1.0.0"</span>,</span><br><span class="line">    <span class="string">"1.1.0"</span>,</span><br><span class="line">    <span class="string">"1.2.0"</span>,</span><br><span class="line">    <span class="string">"1.3.0"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="delete-images-in-registry-server"><a href="#delete-images-in-registry-server" class="headerlink" title="delete images in registry server"></a>delete images in registry server</h1><ol>
<li>delete using registry REST API</li>
</ol>
<ul>
<li>REGISTRY_STORAGE_DELETE_ENABLED必須設定為true，DELETE API才支援</li>
<li>DELETE API僅會刪除link資料，影響API查詢的結果，但實際上的layer data還是存在，必須再執行garbage-collect才能刪除</li>
<li>一定要設定header的Accept為application/vnd.docker.distribution.manifest.v2+json，收到的Content才會是對的<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ curl -I -H <span class="string">"Accept: application/vnd.docker.distribution.manifest.v2+json"</span> http://host:5000/v2/&lt;myimage&gt;/manifests/&lt;tag&gt;</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Length: 1362</span><br><span class="line">Content-Type: application/vnd.docker.distribution.manifest.v2+json</span><br><span class="line">Docker-Content-Digest: sha256:7185dc9a13a5178f5d33654ebe5cf5982e51c9bfff0b1e227e3735dffffe7226</span><br><span class="line">Docker-Distribution-Api-Version: registry/2.0</span><br><span class="line">Etag: <span class="string">"sha256:7185dc9a13a5178f5d33654ebe5cf5982e51c9bfff0b1e227e3735dffffe7226"</span></span><br><span class="line">X-Content-Type-Options: nosniff</span><br><span class="line">Date: Tue, 26 Nov 2019 13:47:34 GMT</span><br><span class="line"></span><br><span class="line">$ curl -v -X DELETE http://host:5000/v2/&lt;myimage&gt;/manifests/sha256:7185dc9a13a5178f5d33654ebe5cf5982e51c9bfff0b1e227e3735dffffe7226</span><br><span class="line">$ docker <span class="built_in">exec</span> -it registry registry garbage-collect /etc/docker/registry/config.yml</span><br><span class="line">$ docker restart registry</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>delete in the file system<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it registry sh</span><br><span class="line">/ <span class="comment"># export NAME="&lt;myimage&gt;"</span></span><br><span class="line">/ <span class="comment"># export VERSION="&lt;tag&gt;"</span></span><br><span class="line">/ <span class="comment"># cd /var/lib/registry/docker/registry/v2</span></span><br><span class="line">/var/lib/registry/docker/registry/v2 <span class="comment"># find . | grep `ls ./repositories/$NAME/_manifests/tags/$VERSION/index/sha256`| xargs rm -rf $1</span></span><br><span class="line">/var/lib/registry/docker/registry/v2 <span class="comment"># rm -rf ./repositories/$NAME/_manifests/tags/$VERSION</span></span><br><span class="line">/var/lib/registry/docker/registry/v2 <span class="comment"># registry garbage-collect /etc/docker/registry/config.yml</span></span><br><span class="line">/ <span class="comment"># exit</span></span><br><span class="line">$ docker restart registry</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="Cleaning-up-the-Registry"><a href="#Cleaning-up-the-Registry" class="headerlink" title="Cleaning up the Registry"></a>Cleaning up the Registry</h1><p>When you delete an image from the registry, this won’t actually remove the blob layers as you might expect. For this reason you have to run this command on your docker registry host to perform garbage collection:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it registry registry garbage-collect /etc/docker/registry/config.yml</span><br></pre></td></tr></table></figure>
<p>And if you wanted to make a cron job that runs every 30 mins:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0,30 * * * * docker <span class="built_in">exec</span> -it registry registry garbage-collect /etc/docker/registry/config.yml &gt;&gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h1 id="GUI-tool-via-docker-image"><a href="#GUI-tool-via-docker-image" class="headerlink" title="GUI tool via docker image"></a>GUI tool via docker image</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -p 8080:8080 --name registry-web -e REGISTRY_URL=http://host:5000/v2 hyper/docker-registry-web</span><br></pre></td></tr></table></figure>
<ul>
<li>by docker-compose.yml<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  registry-web:</span><br><span class="line">    restart: always</span><br><span class="line">    image: hyper/docker-registry-web</span><br><span class="line">    container_name: registry-web</span><br><span class="line">    ports:</span><br><span class="line">      - 8080:8080</span><br><span class="line">    volumes:</span><br><span class="line">      - /etc/timezone:/etc/timezone:ro</span><br><span class="line">      - /etc/localtime:/etc/localtime:ro</span><br><span class="line">    environment:</span><br><span class="line">      - REGISTRY_URL=http://host:5000/v2</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://qcycp.github.io/posts/b4ce8caa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nick Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="筆記本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/b4ce8caa/" class="post-title-link" itemprop="url">設置ubuntu環境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-11-19 11:33:09" itemprop="dateCreated datePublished" datetime="2019-11-19T11:33:09+08:00">2019-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-06-22 09:20:20" itemprop="dateModified" datetime="2020-06-22T09:20:20+08:00">2020-06-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/Ubuntu/" itemprop="url" rel="index"><span itemprop="name">Ubuntu</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p>Ubuntu 16.04.1 Server (64-bit)<br><a href="http://old-releases.ubuntu.com/releases/16.04.1/ubuntu-16.04.1-server-amd64.iso" target="_blank" rel="noopener">http://old-releases.ubuntu.com/releases/16.04.1/ubuntu-16.04.1-server-amd64.iso</a></p>
</li>
<li><p>Ubuntu 16.04.6 Server (64-bit)<br><a href="http://releases.ubuntu.com/16.04/ubuntu-16.04.6-server-amd64.iso" target="_blank" rel="noopener">http://releases.ubuntu.com/16.04/ubuntu-16.04.6-server-amd64.iso</a></p>
</li>
</ul>
<h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><ol>
<li>如果VM的網路卡沒有「僅限主機」介面卡可以用，必須先手動建立<br><code>VirtualBox - 全域工具 - 主機網路管理員</code><br>建立新的network interface<br>可以手動設定ip, f.g. ip: 192.168.199.1, mask: 255.255.255.0</li>
<li>配置網路<br>a. 介面卡1: NAT<br>主要是建立VM的對外網路<br>b. 介面卡2: 「僅限主機」介面卡<br>主要是建立VM跟Windows之間的，可以進行溝通的網路</li>
</ol>
<h1 id="Environment-Setup"><a href="#Environment-Setup" class="headerlink" title="Environment Setup"></a>Environment Setup</h1><ol>
<li>General settings</li>
<li>Python</li>
<li>Docker</li>
</ol>
<h3 id="1-General-Settings"><a href="#1-General-Settings" class="headerlink" title="1. General Settings"></a>1. General Settings</h3><ul>
<li><p>Check the network interface of enp0s8</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ ifconfig -a</span><br></pre></td></tr></table></figure>
<p><img src="/posts/b4ce8caa/network01.jpg" alt></p>
</li>
<li><p>If there is no ip address, set dhcp for enp0s8</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ sudo vim /etc/network/interfaces</span><br></pre></td></tr></table></figure></li>
<li><p>Add following commands at the bottom</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto enp0s8</span><br><span class="line">iface enp0s8 inet dhcp</span><br></pre></td></tr></table></figure></li>
<li><p>Or, you can set static ip address</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auto enp0s8</span><br><span class="line">iface enp0s8 inet static</span><br><span class="line">address 192.168.56.3</span><br></pre></td></tr></table></figure></li>
<li><p>Restart networking and check enp0s8 again</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ sudo service networking restart</span><br><span class="line">user@ubuntu:~$ ifconfig -a</span><br></pre></td></tr></table></figure>
<p><img src="/posts/b4ce8caa/network02.jpg" alt></p>
</li>
<li><p>Install ssh and then you can connect to vm via terminal tools</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ sudo apt-get update</span><br><span class="line">user@ubuntu:~$ sudo apt-get install ssh</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="2-Python"><a href="#2-Python" class="headerlink" title="2. Python"></a>2. Python</h3><ul>
<li><p>Install python3.6</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ sudo add-apt-repository ppa:deadsnakes/ppa</span><br><span class="line">user@ubuntu:~$ sudo apt-get update</span><br><span class="line">user@ubuntu:~$ sudo apt-get install python3.6</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create update-alternatives list for python</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.5 1</span><br><span class="line">update-alternatives: using /usr/bin/python3.5 to provide /usr/bin/python (python) <span class="keyword">in</span> auto mode</span><br><span class="line">user@ubuntu:~$ sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.6 2</span><br><span class="line">update-alternatives: using /usr/bin/python3.6 to provide /usr/bin/python (python) <span class="keyword">in</span> auto mode</span><br><span class="line"></span><br><span class="line">user@ubuntu:~$ update-alternatives --list python</span><br><span class="line">/usr/bin/python3.5</span><br><span class="line">/usr/bin/python3.6</span><br></pre></td></tr></table></figure>
</li>
<li><p>Set default command of python</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ sudo update-alternatives --config python</span><br><span class="line">There are 2 choices <span class="keyword">for</span> the alternative python (providing /usr/bin/python).</span><br><span class="line"></span><br><span class="line">  Selection    Path                Priority   Status</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">* 0            /usr/bin/python3.6   2         auto mode</span><br><span class="line">  1            /usr/bin/python3.5   1         manual mode</span><br><span class="line">  2            /usr/bin/python3.6   2         manual mode</span><br><span class="line"></span><br><span class="line">Press &lt;enter&gt; to keep the current choice[*], or <span class="built_in">type</span> selection number: 2</span><br><span class="line"></span><br><span class="line">user@ubuntu:~$ python -V</span><br><span class="line">Python 3.6.9</span><br></pre></td></tr></table></figure>
</li>
<li><p>Install pip for python3.6</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ curl https://bootstrap.pypa.io/get-pip.py | sudo python3.6</span><br></pre></td></tr></table></figure></li>
<li><p>Install virtualenv or virtualenvwrapper<br>There are two types of environment control for python.<br><code>virtualenv</code>: isolated for each project<br><code>virtualenvwrapper</code>: you can share environment settings between different projects</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ pip install virtualenv --user</span><br><span class="line">user@ubuntu:~$ pip install virtualenvwrapper --user</span><br></pre></td></tr></table></figure>
</li>
<li><p>Install related packages</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ sudo apt-get install make</span><br><span class="line">user@ubuntu:~$ sudo apt-get install gcc</span><br><span class="line">user@ubuntu:~$ sudo apt-get install libssl-dev</span><br><span class="line">user@ubuntu:~$ sudo apt-get install python3.6-dev</span><br><span class="line">user@ubuntu:~$ sudo apt-get install libmysqlclient-dev</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3-Docker"><a href="#3-Docker" class="headerlink" title="3. Docker"></a>3. Docker</h3><ul>
<li><p>Install docker<br>You can install docker online or via deb files</p>
</li>
<li><p>Online install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ curl -sSL https://get.docker.com/ | sh</span><br><span class="line"><span class="comment"># Executing docker install script, commit: f45d7c11389849ff46a6b4d94e0dd1ffebca32c1</span></span><br><span class="line">+ sudo -E sh -c apt-get update -qq &gt;/dev/null</span><br><span class="line">+ sudo -E sh -c DEBIAN_FRONTEND=noninteractive apt-get install -y -qq apt-transport-https ca-certificates curl &gt;/dev/null</span><br><span class="line">+ sudo -E sh -c curl -fsSL <span class="string">"https://download.docker.com/linux/ubuntu/gpg"</span> | apt-key add -qq - &gt;/dev/null</span><br><span class="line">+ sudo -E sh -c <span class="built_in">echo</span> <span class="string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu xenial stable"</span> &gt; /etc/apt/sources.list.d/docker.list</span><br><span class="line">+ sudo -E sh -c apt-get update -qq &gt;/dev/null</span><br><span class="line">+ [ -n  ]</span><br><span class="line">+ sudo -E sh -c apt-get install -y -qq --no-install-recommends docker-ce &gt;/dev/null</span><br><span class="line">+ sudo -E sh -c docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           19.03.5</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.12.12</span><br><span class="line"> Git commit:        633a0ea838</span><br><span class="line"> Built:             Wed Nov 13 07:50:12 2019</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.5</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.12.12</span><br><span class="line">  Git commit:       633a0ea838</span><br><span class="line">  Built:            Wed Nov 13 07:48:43 2019</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.2.10</span><br><span class="line">  GitCommit:        b34a5c8af56e510852c35414db4c1f4fa6172339</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc8+dev</span><br><span class="line">  GitCommit:        3e425f80a8c931f88e6d94a8c831b9d5aa481657</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683</span><br><span class="line">If you would like to use Docker as a non-root user, you should now consider</span><br><span class="line">adding your user to the <span class="string">"docker"</span> group with something like:</span><br><span class="line"></span><br><span class="line">  sudo usermod -aG docker user</span><br><span class="line"></span><br><span class="line">Remember that you will have to <span class="built_in">log</span> out and back <span class="keyword">in</span> <span class="keyword">for</span> this to take effect!</span><br><span class="line"></span><br><span class="line">WARNING: Adding a user to the <span class="string">"docker"</span> group will grant the ability to run</span><br><span class="line">         containers <span class="built_in">which</span> can be used to obtain root privileges on the</span><br><span class="line">         docker host.</span><br><span class="line">         Refer to https://docs.docker.com/engine/security/security/<span class="comment">#docker-daemon-attack-surface</span></span><br><span class="line">         <span class="keyword">for</span> more information.</span><br></pre></td></tr></table></figure>
</li>
<li><p>deb file<br><a href="https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/" target="_blank" rel="noopener">https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user@ubuntu:~$ wget --no-check-certificate https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/containerd.io_1.2.6-3_amd64.deb</span><br><span class="line">user@ubuntu:~$ wget --no-check-certificate https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/docker-ce-cli_19.03.4~3-0~ubuntu-xenial_amd64.deb</span><br><span class="line">user@ubuntu:~$ wget --no-check-certificate https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/docker-ce_19.03.4~3-0~ubuntu-xenial_amd64.deb</span><br><span class="line">user@ubuntu:~$ sudo dpkg -i containerd.io_1.2.6-3_amd64.deb</span><br><span class="line">user@ubuntu:~$ sudo dpkg -i docker-ce-cli_19.03.4~3-0~ubuntu-xenial_amd64.deb</span><br><span class="line">user@ubuntu:~$ sudo dpkg -i docker-ce_19.03.4~3-0~ubuntu-xenial_amd64.deb</span><br><span class="line">user@ubuntu:~$ docker --version</span><br><span class="line">Docker version 19.03.4, build 9013bf583a</span><br></pre></td></tr></table></figure>
</li>
<li><p>Install docker-compose</p>
<h4 id="release-page"><a href="#release-page" class="headerlink" title="release page"></a>release page</h4><p><a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener">https://github.com/docker/compose/releases</a></p>
</li>
</ul>
<h4 id="Install-docker-compose-1-22-0-on-ubuntu"><a href="#Install-docker-compose-1-22-0-on-ubuntu" class="headerlink" title="Install docker-compose (1.22.0) on ubuntu"></a>Install docker-compose (1.22.0) on ubuntu</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ rm -rf /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">$ curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">$ chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">$ docker-compose --version</span><br><span class="line">docker-compose version 1.22.0, build f46880fe</span><br></pre></td></tr></table></figure>

<ul>
<li>Remove docker<ul>
<li>查看系統中有安裝多少跟docker有關的package<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> dpkg -l | grep -i docker</span></span><br></pre></td></tr></table></figure></li>
<li>remove all packages about docker<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get purge -y docker-ce</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get autoremove -y --purge docker-ce</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get autoclean</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo rm -rf /var/lib/docker</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://qcycp.github.io/posts/6ca74c1e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nick Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="筆記本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/6ca74c1e/" class="post-title-link" itemprop="url">Markdown to HTML</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-11-14 21:12:56" itemprop="dateCreated datePublished" datetime="2019-11-14T21:12:56+08:00">2019-11-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-06-22 09:20:20" itemprop="dateModified" datetime="2020-06-22T09:20:20+08:00">2020-06-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/Sublime-Text-3/" itemprop="url" rel="index"><span itemprop="name">Sublime Text 3</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li>在Sublime Text 3上，安裝MarkdownEditing</li>
</ol>
<ul>
<li>Preferences-&gt;Package Control<br><img src="/posts/6ca74c1e/image01.jpg" alt></li>
<li>輸入Install Package<br><img src="/posts/6ca74c1e/image02.jpg" alt></li>
<li>接著輸入MarkdownEditing，即可安裝完成<br><img src="/posts/6ca74c1e/image03.jpg" alt><br><img src="/posts/6ca74c1e/image04.jpg" alt></li>
</ul>
<ol start="2">
<li>轉換<br>在欲轉換的文件中，按下fn+F7，即可生成相對應的HTML檔案<br><img src="/posts/6ca74c1e/image05.jpg" alt></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://qcycp.github.io/posts/7de9a293/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nick Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="筆記本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/7de9a293/" class="post-title-link" itemprop="url">curl指令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-11-11 20:42:15" itemprop="dateCreated datePublished" datetime="2019-11-11T20:42:15+08:00">2019-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-06-22 09:20:20" itemprop="dateModified" datetime="2020-06-22T09:20:20+08:00">2020-06-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software/curl/" itemprop="url" rel="index"><span itemprop="name">curl</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h1><ul>
<li><code>curl -X GET http://localhost:80/api/get</code></li>
<li><code>curl -X GET &quot;http://localhost:80/api/get?param1=abc&amp;param2=123&quot;</code></li>
</ul>
<h1 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h1><ul>
<li>form<ul>
<li><code>curl -X POST -d &quot;username=admin&amp;password=123456&quot; http://localhost:80/auth/login</code></li>
</ul>
</li>
<li>json<ul>
<li><code>curl -H &quot;Content-Type:application/json&quot; -X POST -d &#39;{&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;123456&quot;}&#39; http://localhost:80/auth/login</code></li>
</ul>
</li>
<li><code>curl -X POST -F &quot;image=@/home/user/test.jpg&quot; http://localhost:80/upload/image</code></li>
<li><code>curl -X POST -F &quot;image=@/home/user/test.jpg&quot; -F &quot;token=123456&quot; http://localhost:80/upload/image</code></li>
<li><code>curl -X POST -H &#39;Content-Type: application/json&#39; -d &#39;{&quot;username&quot;: &quot;test&quot;, &quot;password&quot;:&quot;123456&quot;, &quot;list_data&quot;:[1, 2]}&#39; http://localhost:80/api/post</code></li>
<li><code>curl -X POST --data-urlencode &#39;photo=&#39;&quot;$(base64 image.jpg)&quot;&#39;&#39; -d &quot;name=Nick&quot; http://localhost:80/upload/data</code></li>
<li><code>curl -X POST -H &quot;Content-Type: application/json&quot; -d @/home/user/data.json http://localhost:80/api/file/payload</code></li>
</ul>
<h1 id="PUT"><a href="#PUT" class="headerlink" title="PUT"></a>PUT</h1><ul>
<li><code>curl -X PUT -d &quot;data=test&quot; http://localhost:80/api/put</code></li>
</ul>
<h1 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h1><ul>
<li><code>curl -X DELETE http://localhost:80/api/delete</code></li>
</ul>
<h1 id="Download-file"><a href="#Download-file" class="headerlink" title="Download file"></a>Download file</h1><ul>
<li><code>curl -X GET &quot;http://localhost:80/api/download/data&quot; --output file.ext</code></li>
</ul>
<h1 id="Show-headers"><a href="#Show-headers" class="headerlink" title="Show headers"></a>Show headers</h1><ul>
<li><code>curl -i -X POST -d &#39;username=admin&amp;password=123456&#39; http://localhost:80/auth/login</code><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.10.3 (Ubuntu)</span><br><span class="line">Date: Mon, 03 Jun 2019 02:43:54 GMT</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 1062</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Set-Cookie: session=3c8d8462-8590-435e-9227-485f96e4bec5; HttpOnly; Path=/</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"code"</span>: 0,</span><br><span class="line">  <span class="string">"data"</span>: <span class="string">"..."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>Get further information from curl<ul>
<li>simple mode<br><code>$ curl -w &#39;Total: %{time_total}s\n&#39; -o /dev/null -s http://ip:port/api/</code></li>
<li>Create a new file, curl-format.txt, and paste in:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   time_namelookup:  %&#123;time_namelookup&#125;s\n</span><br><span class="line">      time_connect:  %&#123;time_connect&#125;s\n</span><br><span class="line">   time_appconnect:  %&#123;time_appconnect&#125;s\n</span><br><span class="line">  time_pretransfer:  %&#123;time_pretransfer&#125;s\n</span><br><span class="line">     time_redirect:  %&#123;time_redirect&#125;s\n</span><br><span class="line">time_starttransfer:  %&#123;time_starttransfer&#125;s\n</span><br><span class="line">                   ----------\n</span><br><span class="line">        time_total:  %&#123;time_total&#125;s\n</span><br></pre></td></tr></table></figure></li>
<li>Make a request<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl -w &quot;@curl-format.txt&quot; -o /dev/null -s &quot;http://ip:port/api/&quot;</span><br><span class="line">-w &quot;@curl-format.txt&quot; tells cURL to use our format file</span><br><span class="line">-o /dev/null redirects the output of the request to /dev/null</span><br><span class="line">-s tells cURL not to show a progress meter</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/20/"><i class="fa fa-angle-left" aria-label="上一頁"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/22/"><i class="fa fa-angle-right" aria-label="下一頁"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Nick Cheng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">227</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nick Cheng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 強力驅動
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
